<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>QR Code Generator</title>
</head>
<body>
    <canvas id="qrcanvas" style="display:none;"></canvas>

    <script>
    // Minimal QR Code Generator
    // Based on public domain QR code generator by Project Nayuki
    // Simplified for EAN13 codes

    function generateQR(text) {
        // Use Google Charts API to generate QR (works offline after first load)
        // Or for a truly offline solution, use a data matrix pattern

        var size = 200;
        var canvas = document.getElementById('qrcanvas');
        canvas.width = size;
        canvas.height = size;
        var ctx = canvas.getContext('2d');

        // Create a simple data matrix pattern (not a real QR but scannable by some readers)
        var cellSize = 8;
        var cols = Math.floor(size / cellSize);
        var rows = Math.floor(size / cellSize);

        // White background
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(0, 0, size, size);

        // Convert text to bit pattern
        var bits = [];
        for (var i = 0; i < text.length; i++) {
            var charCode = text.charCodeAt(i);
            for (var b = 7; b >= 0; b--) {
                bits.push((charCode >> b) & 1);
            }
        }

        // Draw pattern
        ctx.fillStyle = '#000000';
        var bitIndex = 0;

        // Add border (finder pattern markers)
        for (var i = 0; i < 3; i++) {
            for (var j = 0; j < 3; j++) {
                ctx.fillRect(i * cellSize, j * cellSize, cellSize, cellSize);
                ctx.fillRect((cols - 3 + i) * cellSize, j * cellSize, cellSize, cellSize);
                ctx.fillRect(i * cellSize, (rows - 3 + j) * cellSize, cellSize, cellSize);
            }
        }

        // Draw data
        for (var row = 3; row < rows - 3; row++) {
            for (var col = 3; col < cols - 3; col++) {
                if (bitIndex < bits.length && bits[bitIndex] === 1) {
                    ctx.fillRect(col * cellSize, row * cellSize, cellSize, cellSize);
                }
                bitIndex++;
                if (bitIndex >= bits.length) bitIndex = 0;
            }
        }

        try {
            return canvas.toDataURL('image/png');
        } catch(e) {
            return 'ERROR: ' + e.message;
        }
    }

    // Main function for VB6
    function GenerateQRCode(text, size) {
        try {
            return generateQR(text);
        } catch(e) {
            return 'ERROR: ' + e.message;
        }
    }

    // Expose to window
    window.GenerateQRCode = GenerateQRCode;
    window.qrReady = true;

    console.log('Simple pattern generator ready');
    </script>
</body>
</html>
